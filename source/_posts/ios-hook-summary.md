---
title: iOSé€†å‘å·¥ç¨‹å®è·µ
date: 2016-08-24 23:27:47
tags: iOS
categories: æŠ€æœ¯ç›¸å…³
---


å€Ÿä¸€æ¬¡å¸®åŒå­¦ç ´è§£æŸå¥‡è‘©çš„appçš„æœºä¼šï¼Œåˆæ­¥äº†è§£å¹¶æŒæ¡äº†iOSé€†å‘ç›¸å…³çŸ¥è¯†ã€‚

## ç›®çš„

è§£å‡ºæŸä¸ªç±»ä¼¼æŒ–çŸ¿çš„appçš„é€šä¿¡åè®®ï¼Œç„¶åå†™ä¸ªè„šæœ¬è‡ªåŠ¨æŒ–çŸ¿

## äº†è§£

å¼€å§‹ä¸€å¤´é›¾æ°´ï¼Œappèƒ½æŒ–çŸ¿ï¼Ÿç”¨äº†ä¸€æ®µæ—¶é—´æ‰å¤§è‡´äº†è§£ä»–çš„åŸç†ã€‚ã€‚

è¿™ä¸ªappéœ€è¦é€šè¿‡è“ç‰™è¿æ¥ä¸€ä¸ªç‰¹å®šç©¿æˆ´è®¾å¤‡ï¼Œä¿æŒè®¾å¤‡è¿è¡Œï¼Œé‡‡é›†æ‰€è°“çš„è„‘ç”µæ³¢ã€‚ã€‚é‡‡é›†çš„æ—¶é—´è¶Šé•¿ï¼Œè„‘ç”µæ³¢å›¾å½¢è¶Šå¥½ï¼Œæœ€ç»ˆæ•°æ®ä¸Šä¼ åˆ°æœåŠ¡ç«¯ï¼Œå¾—åˆ†å°±è¶Šé«˜ã€‚

ç½®äºå¥‡è‘©çš„appåšè¿™äº‹å„¿æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚ã€‚åˆ†æ•°å¯ä»¥æ¢æˆè™šæ‹Ÿè´§å¸ï¼Œè€Œè¿™è´§å¸æœ€ç»ˆæ˜¯ä¹°å•çš„å‘¢ï¼Œå…¶å®é‡Œé¢è¿˜æœ‰ä¸ªè§„åˆ™æ˜¯å‘å±•ä¸‹çº¿ï¼Œå¯ä»¥ä»ä¸‹çº¿çš„å¾—åˆ†å¾—åˆ°ææˆï¼Œç„¶åæ¯ä¸ªäººéƒ½éœ€è¦èŠ±é’±ä¹°è¿™ä¸ªç©¿æˆ´è®¾å¤‡æ‰èƒ½é‡‡é›†å›¾å½¢ï¼Œæ¢å–ç§¯åˆ†ï¼Œæ‰€ä»¥é’±æœ€ç»ˆæ˜¯ä»ä¸‹å®¶ä¹°çš„è®¾å¤‡è¿™é‡Œæ¥çš„ï¼Œç±»ä¼¼äºã€‚ã€‚ã€‚ã€‚ä½ æ‡‚å¾—

## é€†å‘å‰çš„åˆ†æ

å…ˆæŠ“åŒ…çœ‹äº†ä¸€ä¸‹ç½‘ç»œè¯·æ±‚ï¼Œå‘ç°å‘é€å’Œæ¥æ”¶çš„æ•°æ®éƒ½ç»è¿‡base64ç¼–ç äº†ï¼Œè§£å‡ºæ¥æ˜¯ä¸€å †ä¹±ç ï¼Œçœ‹æ¥æ˜¯åŠ å¯†è¿‡å•¦ã€‚ï¼ˆä¸ç„¶ä¹Ÿä¸ç”¨å†™è¿™ç¯‡æ–‡ç« äº†- -llï¼‰

ç„¶åæˆ‘å…ˆåç¼–è¯‘å®‰å“ç‰ˆæœ¬çœ‹äº†ä¸€ä¸‹ï¼ˆè¿™ä¸ªæœ‰ç°æˆå·¥å…·æ¯”è¾ƒå¥½æï¼‰ï¼Œè²Œä¼¼æ˜¯ç”¨çˆ±åŠ å¯†åŠ å›ºè¿‡äº†ï¼Œå¾ˆå¤šå…³é”®çš„å‡½æ•°éƒ½åç¼–è¯‘å¤±è´¥äº†çœ‹ä¸åˆ°ï¼Œä¸è¿‡è¿˜æ˜¯çœ‹åˆ°äº†ä¸€äº›çº¿ç´¢ï¼šæ‰¾åˆ°ä¸¤ä¸ªå’ŒAESã€RSAç›¸å…³çš„ç±»åï¼Œä»¥åŠä¸€ä¸ªgetPubKey()å‡½æ•°ï¼Œé‡Œé¢åº”è¯¥æ˜¯RSAå…¬é’¥ã€‚äºæ˜¯çŒœæƒ³æ•°æ®åº”è¯¥æ˜¯ç»è¿‡AESå’ŒRSAåŠ å¯†äº†ã€‚

äºæ˜¯ç¢°åˆ°ä¸€ä¸ªå‘ï¼špythonæ²¡æ³•ç”¨å…¬é’¥è§£å¯†æ•°æ®ã€‚ã€‚ã€‚æœäº†å¾ˆä¹…ï¼Œè§£å†³æ–¹æ¡ˆéƒ½æ˜¯ä¸€æœ¬æ­£ç»åœ°è¯´ï¼Œä½ ä¸åº”è¯¥ç”¨ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†ï¼Œè¿™æ ·åšæ˜¯ä¸å¯¹çš„

(â•¯â€µâ–¡â€²)â•¯ï¸µâ”»â”â”»

å¯¹ä¸å¯¹å…³æˆ‘piså•Šï¼ï¼ï¼@#ï¿¥%â€¦â€¦&*

ä¸€åº¦æ€€ç–‘æˆ‘æ˜¯ä¸æ˜¯åšé”™äº†ï¼Œæ˜¯ä¸æ˜¯appé‡Œè¿˜è—äº†ç§é’¥ï¼ˆç„¶è€Œå¹¶æ²¡æœ‰ï¼‰

èŠ±äº†å¤§åŠå¤©è¿˜æ˜¯è§£å†³ä¸äº†ï¼Œæœ€åç”¨javaå†™äº†ä¸ªç”¨å…¬é’¥è§£å¯†çš„ç±»ã€‚ã€‚ã€‚

åˆ†æä¸ä¸‹å»äº†ï¼Œé‚£ä¹ˆå¼€å§‹é€†å‘å§- -ll

## è„±å£³

AppStoreä¸‹è½½ä¸‹æ¥çš„ipaéƒ½æ˜¯ç»è¿‡åŠ å¯†çš„ï¼Œè§£å‹å‡º.appï¼Œç”¨`otool`å¯ä»¥çœ‹åˆ°äºŒè¿›åˆ¶æ–‡ä»¶çš„ä¿¡æ¯é‡Œï¼Œæœ‰ä¸€ä¸ª`cryptid`å­—æ®µï¼Œ1ä»£è¡¨è¢«åŠ å¯†ï¼Œ0å°±æ˜¯æ²¡åŠ å¯†ï¼Œè§£å¯†çš„è¿‡ç¨‹è¢«ç§°ä½œè„±å£³

è·å–è„±å£³åçš„åº”ç”¨æœ‰ä¸¤ç§é€”å¾„ï¼š

1. ä»PPåŠ©æ‰‹ç­‰è¶Šç‹±å¸‚åœºä¸‹è½½è¶Šç‹±åº”ç”¨ï¼Œæ¯”è¾ƒçœäº‹ï¼Œç¼ºç‚¹æ˜¯å†·é—¨appä½ ä¸ä¸€å®šæ‰¾å¾—åˆ°ï¼ˆæˆ–æ˜¯Surgeè¿™ç§ç‰¹æ®Šçš„appï¼Œåº”è¯¥ä¸ç®—å†·é—¨å§ï¼Œä½†æ˜¯è¶Šç‹±å¸‚åœºéƒ½æ˜¯æ‰¾ä¸åˆ°çš„ï¼‰

2. è‡ªè¡Œç ¸å£³/è„±å£³ï¼Œä½¿ç”¨[dumpdecrypted](https://github.com/stefanesser/dumpdecrypted)ã€[Clutch](https://github.com/KJCracks/Clutch)å·¥å…·ï¼ˆéœ€è¦ä¸€å°è¶Šç‹±çš„è®¾å¤‡ï¼‰ç ¸å£³åå†ç”¨sshã€scpä¹‹ç±»çš„æ‹·è´åˆ°macä¸Šï¼Œç•¥ä¸ºç¹ç

## é‡ç­¾å

æŒ‰ç†è¶Šç‹±æ‰‹æœºæ˜¯æ²¡æœ‰è¿™ä¸ªé—®é¢˜çš„å§ï¼Ÿã€‚ã€‚å¯èƒ½9.3.3æ˜¯ä¸å®Œç¾è¶Šç‹±çš„ç¼˜æ•…

æ›¿æ¢æˆæœ‰æ•ˆçš„bundle_id, codesigning_identity, privisioning_profileï¼Œå†å¯¹appé‡æ–°æ‰“åŒ…ï¼Œå°±å¯ä»¥åœ¨æ‰‹æœºä¸Šå®‰è£…äº†ï¼ˆåŒ…æ‹¬éè¶Šç‹±è®¾å¤‡ï¼‰

è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨[iOS App Signer](https://github.com/DanTheMan827/ios-app-signer)å®ç°ï¼Œè¿˜ç®—æ–¹ä¾¿

## å®‰è£…è¶Šç‹±ç›¸å…³å·¥å…·

ä¸€å¤§å †ä¸œè¥¿ï¼Œæœ‰çš„æ²¡çš„åæ­£èƒ½è£…çš„éƒ½è£…ä¸Šå§ã€‚ã€‚

- iOSOpenDevï¼ˆè¶Šç‹±å¼€å‘ç¯å¢ƒï¼‰
- theosï¼ˆåŒä¸Šï¼‰
- [cycript](http://www.cycript.org/)
- [Clutch](https://github.com/KJCracks/Clutch)
- [class-dump](https://github.com/nygard/class-dump)ï¼ˆä»Mach-Oæ–‡ä»¶ä¸­ï¼Œå¯¼å‡ºæ‰€æœ‰OCç±»çš„å¤´æ–‡ä»¶ï¼‰
- mobiledeviceï¼ˆç›´æ¥å®‰è£…ipaåˆ°æ‰‹æœºä¸Šï¼‰
- ideviceinstallerï¼ˆåŒä¸Šï¼‰
- [yololib](https://github.com/KJCracks/yololib)ï¼ˆå°†dylibæ³¨å…¥åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒHook Appï¼‰
- Hopperï¼ˆMacåç¼–è¯‘å·¥å…·ï¼‰

iOSç‰ˆæœ¬å¤ªæ–°è¿˜æ˜¯è›®å°´å°¬çš„ï¼Œè¶Šç‹±ç›¸å…³çš„å·¥å…·ä¸€èˆ¬ä¸ä¼šå¾ˆå¿«çš„æ›´æ–°ï¼Œç”šè‡³æœ‰äº›éƒ½ä¸ç»´æŠ¤äº†ï¼Œå†åŠ ä¸Š9.3.3æ˜¯ä¸å®Œç¾è¶Šç‹±ï¼Œå¯¼è‡´éƒ¨åˆ†å·¥å…·ä¸å¯ç”¨ï¼ˆcycriptï¼‰ï¼Œéƒ¨åˆ†æ•™ç¨‹ä¸å¯å‚è€ƒï¼Œé‡ä¸Šäº†å¾ˆå¤šå›°éš¾ã€‚

å†ç”±äºæˆ‘è¦ç ´è§£çš„appæ˜¯swiftå†™çš„ï¼Œclass-dumpä¸å¯ç”¨ï¼ŒiOSOpenDevæ–°å»ºçš„æ¨¡æ¿ä¹Ÿæ²¡æ³•ç›´æ¥ç”¨ï¼Œäºšå†å±±å¤§å•Šâ•®(â•¯â–½â•°)â•­

## å¯»æ‰¾è¦Hookçš„ç›®æ ‡

å…ˆåˆ—å‡ºappæ‰€æœ‰ç±»åå’Œæ–¹æ³•åã€‚class-dumpã€flex3ã€hopperè¿™äº›éƒ½èƒ½ç”¨ï¼Œå…¶ä¸­class-dumpå¯ä»¥ç›´æ¥å¯¼å‡ºæ‰€æœ‰å¤´æ–‡ä»¶ï¼Œä¸è¿‡æš‚ä¸æ”¯æŒswiftã€‚

ç”±äºOCçš„runtimeæœºåˆ¶ï¼Œæ–¹æ³•éƒ½æ˜¯åŠ¨æ€çš„ï¼Œå¦‚æœåƒjavaé‚£æ ·ç›´æ¥æ··æ·†ç±»åå’Œæ–¹æ³•åï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€è°ƒç”¨æ–¹æ³•å°±ä¼šå‡ºé”™å§ã€‚æ‰€ä»¥èƒ½ä»ç±»åé‡Œè·å–åˆ°å¾ˆå¤šä¿¡æ¯ã€‚

ï¼ˆå¸Œæœ›ä»¥åèƒ½æœ‰è¿™æ–¹é¢çš„åŠ å¯†å·¥å…·ï¼Œæ‰¾åˆ°è¿‡å‡ ä¸ªç›¸å…³çš„è„šæœ¬æ„Ÿè§‰ä¸æ˜¯å¤ªå¯é ï¼Œå¹¶ä¸”éœ€è¦ä¿®æ”¹ä»£ç é…åˆæ··æ·†ï¼Œæœ‰ä¸€å®šçš„å¼€å‘é‡ï¼Œä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼‰

å¤§è‡´ç¡®å®šäº†å‡ ä¸ªç›®æ ‡ï¼š

- `[SecurityUtil encryptAESData:app_key:]`
- `[SecurityUtil decryptAESData:app_key:]`
- `[MindAsset.RSAUtils addRSAPrivateKey:tagName:]`
- `[MindAsset.RSAUtils addRSAPublicKey:tagName:]`
- `[MindAsset.HttpManager uploadDataToAliyun:accessKeyId:secretKeyId:sucessblock:]`

æˆ‘å°è¯•çš„æ–¹æ¡ˆæ˜¯ï¼šç¼–å†™dylibæ³¨å…¥åˆ°åº”ç”¨ä¸­ï¼Œåœ¨åº”ç”¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œswizzleè¿™å‡ ä¸ªæ–¹æ³•ï¼Œç„¶ååœ¨è®¾å¤‡æ—¥å¿—é‡Œæ‰¾åˆ°æˆ‘æ‰“å°çš„æ—¥å¿—ï¼Œåˆ†æçº¿ç´¢

ä¸ºä»€ä¹ˆä¸ç›´æ¥è°ƒè¯•appå‘¢(â•¯â€µâ–¡â€²)â•¯ï¸µâ”»â”â”»

æˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œè¯•äº†ä¸€ä¸‹è°ƒè¯•ä¸äº†ã€‚ã€‚æœ‰ç©ºå†ç¢ç£¨ä¸€ä¸‹ä¸ºä»€ä¹ˆ

æ„Ÿè§‰ç›´æ¥è°ƒè¯•ä¼šæ›´æ–¹ä¾¿

## å¼€å§‹Hook

æ–°å»ºXcodeé¡¹ç›®ï¼Œé€‰æ‹©`CaptainHook Tweak`æ¨¡æ¿ï¼Œ`*.xm`æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œå¯ä»¥ç”¨`%hook`ã€`%log`ã€`%orig`æ–¹ä¾¿çš„å¯¹æŸä¸ªç±»çš„æ–¹æ³•è¿›è¡Œhookã€‚

xmæ–‡ä»¶å¤´éƒ¨å®šä¹‰äº†ä¸€ä¸ªerrorï¼š

```
#error iOSOpenDev post-project creation from template requirements (remove these lines after completed) -- \
	Link to libsubstrate.dylib: \
	(1) go to TARGETS > Build Phases > Link Binary With Libraries and add /opt/iOSOpenDev/lib/libsubstrate.dylib \
	(2) remove these lines from *.xm files (not *.mm files as they're automatically generated from *.xm files)
```

éœ€è¦ä»ä½ çš„`iOSOpenDev`ç›®å½•é‡Œå¼•å…¥`libsubstrate.dylib`ï¼Œç„¶åæŠŠè¿™æ®µerroræ³¨é‡Šæ‰å°±å¥½äº†ã€‚åœ¨buildçš„æ—¶å€™é¡¹ç›®ä¼šè·‘ä¸€ä¸ªè„šæœ¬å¯¹è¿™äº›æ ‡è®°è¿›è¡Œæ›¿æ¢ï¼Œå†ç”¨å®å®šä¹‰å¼•å…¥è‡³`*.mm`æ–‡ä»¶ä¸­ï¼Œç¼–è¯‘æˆdylibã€‚

xmæ–‡ä»¶ç”¨ç€ä¸å¤ªä¹ æƒ¯ï¼Œæ²¡æœ‰è¯­æ³•é«˜äº®äº†ã€‚ã€‚ç›´æ¥åƒå¹³æ—¶å¼€å‘çš„æ—¶å€™é‚£æ ·åŠ ä¸ªcategoryï¼Œè‡ªå·±å†™swizzleä¹Ÿå¯ä»¥ã€‚ã€‚

[xmæ–‡ä»¶å†™æ³•-Logos](http://iphonedevwiki.net/index.php/Logos)

```
%hook SecurityUtil

+ (id)encryptAESData:(id)data app_key:(id)key {
    
    id result = %orig(data, key);
    
    NSLog(@"encryptAESData '%@' '%@' '%@'", data, key, result);
    
    return result;
}

+ (id)decryptAESData:(id)data app_key:(id)key {
    
    id result = %orig(data, key);
    
    NSLog(@"decryptAESData '%@' '%@' '%@'", data, key, result);
    
    return result;
}

%end

```

ç¼–è¯‘ååœ¨Productsæ‰¾åˆ°ç¼–è¯‘å¥½çš„dylibï¼Œç„¶åç”¨yololibå·¥å…·æŠŠå®ƒæ³¨å…¥åˆ°Mach-Oæ–‡ä»¶ä¸­ã€‚

```
â†’ ./yololib MindAsset hook.dylib
2016-08-23 22:24:50.338 yololib[71513:1121551] dylib path @executable_path/hook.dylib
2016-08-23 22:24:50.351 yololib[71513:1121551] dylib path @executable_path/hook.dylib
Reading binary: MindAsset

2016-08-23 22:24:50.351 yololib[71513:1121551] Thin 64bit binary!
2016-08-23 22:24:50.351 yololib[71513:1121551] dylib size wow 56
2016-08-23 22:24:50.352 yololib[71513:1121551] mach.ncmds 60
2016-08-23 22:24:50.352 yololib[71513:1121551] mach.ncmds 61
2016-08-23 22:24:50.352 yololib[71513:1121551] Patching mach_header..
2016-08-23 22:24:50.352 yololib[71513:1121551] Attaching dylib..

2016-08-23 22:24:50.352 yololib[71513:1121551] size 51
2016-08-23 22:24:50.352 yololib[71513:1121551] complete!
```

å†æŠŠMach-Oå’Œdylibä¸€åŒå¤åˆ¶å›.appç›®å½•ä¸‹ï¼Œé‡æ–°æ‰“åŒ…ç­¾åï¼Œè£…ä¸Šæ‰‹æœºè¿è¡Œï¼Œç”¨Xcodeæˆ–è€…å‘½ä»¤è¡Œå·¥å…·`idevicesyslog`æŸ¥çœ‹æ‰‹æœºè¿è¡Œæ—¥å¿—ï¼š

```
Aug 29 00:15:48 iPhone7s MindAsset[11330] <Warning>: encryptAESData '{"password":"123456","version":"1.0.22","mobile":"18000000000","platform":"iOS"}' 'fucgqsdlefath' 'YV4F2uYUK3BmM90at/5leyfsz7/OJ+V/k8WTyC0WYrP4M1zbSZdIP47XxuPaXXCsRRdCf0YeldRtMBwCbRNc9rTgNgTz+BGWQ/iaYubbVv71w8yMJ/gCDu8nL8ijoeKl'
Aug 29 00:15:48 iPhone7s MindAsset[11330] <Warning>: decryptAESData '<1c4e3425 bff4c6ec 525dd10b b3afc339 944337ff 9d5a2ef3 066d7e07 0d05bf22 8e623abf a80be7c1 555cd64c ba436103 61830f09 b34e99a1 a29f3d4a 0800ca50 effb627e baf387bf 00b8a175 7f3b3b97 93fcbb47 68984e88 8828f665 775af738 2620e5b8 53127e7b 4ba016bb c77b5ad6 e5ec0e20 640f6608 625fb4da 9078e1ed 5257e9da 192d55bc 1f3c4ffa 3679f358 5dd79f05 3b7652e4 de0f2e07 10f44396 bd8a1ec0 3a181590 6dccbee6 ddb96f8b bf9a22b5 4878833d ff624f0a 41377208 5532679e 5b5d6145 914d61ae 0fa42ca5 67807fa2 98775bd8 8badae71 be95363b ea22806c 49c7e0fc 11eb86fb 58e5a0af efc902e8 407bd0e0 019cc2bb 8a841c65>' '5Mvk20CB' '{"status":0,"data":{"uid":xxx,"invitor_name":"xxx","huanxin_id":"xxx","huanxin_pwd":"xxx","in_use_huanxin_customer":1,"waiter_id":"xxx","waiter_name":"xxx"}}'
```

HookæˆåŠŸäº†ï¼Œå‘ç°ç¡®å®è°ƒç”¨äº†AESæ–¹æ³•ï¼Œä½†æ˜¯æ¯æ¬¡åŠ å¯†è§£å¯†çš„aesKeyéƒ½æ˜¯ä¼šå˜çš„ï¼Œçœ‹ç€åƒéšæœºç”Ÿæˆçš„ï¼Œé‚£ä¹ˆè”æƒ³åˆ°apkæ–‡ä»¶é‡Œæ‰¾åˆ°çš„RSAå…¬é’¥ï¼Œå†å¯¹RSAçš„åŠ è§£å¯†æ–¹æ³•hookä¸€ä¸‹çœ‹çœ‹

## Cå‡½æ•°Hook

ä¹‹å‰æŸ¥çœ‹äº†ä¸€ä¸‹åº”ç”¨æ‰€æœ‰ç”¨åˆ°çš„ç±»ï¼Œæ²¡æœ‰ç¬¬ä¸‰æ–¹çš„åŠ å¯†åº“ï¼Œé‚£ä¹ˆæˆ‘çŒœç”¨çš„æ˜¯ç³»ç»Ÿè‡ªå¸¦çš„`SecKeyEncrypt`ã€`SecKeyDecrypt`æ–¹æ³•

Cå‡½æ•°ä¹Ÿæ˜¯å¯ä»¥hookæ»´ï¼Œç”¨facebookçš„[fishhook](https://github.com/facebook/fishhook)å§

```
#import <fishhook/fishhook.h>
#import <dlfcn.h>
#import <CommonCrypto/CommonCrypto.h>


//SecKeyEncrypt
static OSStatus (*orig_SecKeyEncrypt)(SecKeyRef, SecPadding, const uint8_t *, size_t, uint8_t *, size_t *);
static OSStatus my_SecKeyEncrypt(
                                 SecKeyRef key,
                                 SecPadding padding,
                                 const uint8_t *plainText,
                                 size_t plainTextLen,
                                 uint8_t *cipherText,
                                 size_t *cipherTextLen) {

    OSStatus result = orig_SecKeyEncrypt(key, padding, plainText, plainTextLen, cipherText, cipherTextLen);
    
    NSData *cipherData = nil;
    NSData *plainData = nil;
//    NSData *cipherData = [NSData dataWithBytesNoCopy:cipherText length:cipherTextLen];
//    NSData *plainData = [NSData dataWithBytesNoCopy:(void *)plainText length:plainTextLen];
    NSLog(@"SecKeyEncrypt SecPadding: %d, plainData: %@, cipherData: %@", padding, plainData, cipherData);
    
    return result;
}

//SecKeyDecrypt
static OSStatus (*orig_SecKeyDecrypt)(SecKeyRef, SecPadding, const uint8_t *, size_t, uint8_t *, size_t *);
static OSStatus my_SecKeyDecrypt(
                                 SecKeyRef key,
                                 SecPadding padding,
                                 const uint8_t *cipherText,
                                 size_t cipherTextLen,
                                 uint8_t *plainText,
                                 size_t *plainTextLen) {

    OSStatus result = orig_SecKeyDecrypt(key, padding, cipherText, cipherTextLen, plainText, plainTextLen);
    
    NSData *cipherData = nil;
    NSData *plainData = nil;
//    NSData *cipherData = [NSData dataWithBytesNoCopy:(void *)cipherText length:cipherTextLen];
//    NSData *plainData = [NSData dataWithBytesNoCopy:plainText length:plainTextLen];
    NSLog(@"SecKeyDecrypt SecPadding: %d, cipherData: %@, plainData: %@", padding, cipherData, plainData);
    
    return result;
}

//CCCryptorCreate
static CCCryptorStatus (*orig_CCCryptorCreate)(CCOperation, CCAlgorithm, CCOptions, const void *, size_t, const void *, CCCryptorRef *);
static CCCryptorStatus my_CCCryptorCreate(
                                          CCOperation op,
                                          CCAlgorithm alg,
                                          CCOptions options,
                                          const void *key,
                                          size_t keyLength,
                                          const void *iv,
                                          CCCryptorRef *cryptorRef) {

    CCCryptorStatus result = my_CCCryptorCreate(op, alg, options, key, keyLength, iv, cryptorRef);
    
    NSData *keyData = [NSData dataWithBytesNoCopy:(void *)key length:keyLength];
    NSData *ivData = [NSData dataWithBytesNoCopy:(void *)iv length:keyLength];
    NSLog(@"CCCryptorCreate CCOperation: %d, CCAlgorithm: %d, CCOptions: %d, key: %@, iv: %@", op, alg, options, keyData, ivData);
    
    return result;
}

@implementation NSObject (FishHook)

+ (void)load {
    
    NSLog(@"fishhook start");
    
    orig_SecKeyEncrypt = dlsym(RTLD_DEFAULT, "SecKeyEncrypt");
    orig_SecKeyDecrypt = dlsym(RTLD_DEFAULT, "SecKeyDecrypt");
    orig_CCCryptorCreate = dlsym(RTLD_DEFAULT, "CCCryptorCreate");
    
    rebind_symbols((struct rebinding[3]){
        {"SecKeyEncrypt", my_SecKeyEncrypt},
        {"SecKeyDecrypt", my_SecKeyDecrypt},
        {"CCCryptorCreate", my_CCCryptorCreate},
//        {"SecKeyEncrypt", my_SecKeyEncrypt, (void *)orig_SecKeyEncrypt},
//        {"SecKeyDecrypt", my_SecKeyDecrypt, (void *)orig_SecKeyDecrypt},
    }, 3);
    
    NSLog(@"fishhook end");
    
}

@end

```

åæ­£å°±å¤§æ¦‚è¿™ä¹ˆä¸ªæ„æ€ã€‚ã€‚ã€‚æœ€åæ²¡æœ‰ä»è¿™å„¿è·å¾—å•¥ä¿¡æ¯ğŸ˜·

æ‹¿æ‰‹æœºæ—¥å¿—å’Œç½‘ç»œè¯·æ±‚å¯¹æ¯”ï¼Œå°±ææ¸…æ¥šæ¯ä¸ªæ¥å£çš„è¯·æ±‚æ ¼å¼äº†ã€‚è‡³äºå‰é¢éšæœºç”Ÿæˆçš„aesKeyï¼Œç»RSAå…¬é’¥åŠ å¯†ï¼Œéšç½‘ç»œè¯·æ±‚è—åœ¨äº†HTTP Headerä¸­ï¼ŒResponseä¹Ÿæ˜¯ä¸€æ ·ã€‚

## å°ç»“

iOSçš„å®‰å…¨æ€§è¢«å¾ˆå¤šäººç»™å¿½è§†äº†ï¼Œæ²¡æƒ³åˆ°ä¹Ÿæ˜¯æŒºè„†å¼±çš„ã€‚ã€‚

ä»è¿™æ¬¡å°è¯•ä¸­å‘ç°è¿˜æ˜¯æœ‰å¾ˆå¤šè¿æ°”çš„æˆåˆ†çš„â•®(â•¯â–½â•°)â•­

é¦–å…ˆè¦çŒœçš„åˆ°å¤§æ¦‚çš„å…³é”®è¯ï¼Œæ‰¾åˆ°åŠ å¯†è§£å¯†ç›¸å…³ç±»ï¼Œç„¶åhookçœ‹æ—¥å¿—ï¼Œå†å’Œç½‘ç»œè¯·æ±‚çš„æ•°æ®è¿›è¡Œå¯¹æ¯”ï¼Œæœ€åææ¸…æ¥šæ•°æ®ç»“æ„ï¼Œå†™å‡ºä¼ªé€ è¯·æ±‚çš„è„šæœ¬ã€‚

é‡åˆ°çš„å›°éš¾ä¸»è¦æ˜¯ï¼š
- åˆšå‡ºçš„9.3.3ä¸å®Œç¾è¶Šç‹±ï¼Œéƒ¨åˆ†å·¥å…·ä¸å¯ç”¨
- åŸºæœ¬æ˜¯çº¯swiftå†™çš„appï¼Œæ²¡hookæˆåŠŸï¼Œç”¨hopperçœ‹å…·ä½“å®ç°å¾ˆå›°éš¾ï¼Œæœ‰ç‚¹æ— ä»ä¸‹æ‰‹ã€‚ã€‚

æ„Ÿè§‰åº”è¯¥æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œæˆ‘çš„è¿™ä¸ªæµç¨‹ï¼ˆç¼–ç ï¼Œç¼–è¯‘dylibï¼Œæ³¨å…¥ï¼Œæ‰“åŒ…ï¼Œé‡ç­¾åï¼Œå®‰è£…ï¼Œçœ‹æ—¥å¿—ï¼‰å¤ªé•¿äº†ğŸ˜·

æœ‰ç©ºç»§ç»­ç ”ç©¶